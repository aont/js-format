<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>JavaScript Minify / Format Tool</title>

  <script src="https://cdn.jsdelivr.net/npm/terser@5.34/dist/bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prettier@2.8.0/standalone.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prettier@2.8.0/parser-babel.min.js"></script>

  <style>
    :root{
      --bg:#0b0f1a;
      --card:#111827;
      --card2:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --border:rgba(255,255,255,.12);
      --primary:#60a5fa;
      --danger:#f87171;
      --radius:14px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{ box-sizing:border-box; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1000px 700px at 20% -10%, rgba(96,165,250,.25), transparent 55%),
                  radial-gradient(900px 600px at 90% 0%, rgba(248,113,113,.18), transparent 50%),
                  var(--bg);
      color: var(--text);
      line-height:1.45;
    }
    .container{
      max-width: 980px;
      margin: 0 auto;
      padding: max(16px, env(safe-area-inset-top)) 16px max(16px, env(safe-area-inset-bottom));
    }
    header{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom: 14px;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 4.8vw, 28px);
      letter-spacing:.2px;
    }
    .subtitle{
      color: var(--muted);
      font-size: 13px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .toolbar{
      display:flex;
      flex-wrap: wrap;
      gap:10px;
      padding: 12px;
      align-items:center;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,.12);
    }
    .btn{
      appearance:none;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 12px 14px;
      border-radius: 12px;
      font-size: 14px;
      cursor:pointer;
      min-height: 44px; /* mobile tap target */
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      touch-action: manipulation;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: rgba(96,165,250,.55);
      background: rgba(96,165,250,.18);
    }
    .btn.danger{
      border-color: rgba(248,113,113,.55);
      background: rgba(248,113,113,.14);
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
    }

    .split{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      padding: 12px;
    }
    @media (min-width: 860px){
      .split{
        grid-template-columns: 1fr 1fr;
        align-items:start;
      }
    }

    .panel{
      background: rgba(0,0,0,.12);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow:hidden;
    }
    .panelHead{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.03);
    }
    .panelTitle{
      font-size: 13px;
      color: var(--muted);
      letter-spacing:.2px;
    }
    .panelActions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    textarea{
      width:100%;
      min-height: 42vh;
      resize: vertical;
      padding: 12px;
      border: 0;
      outline: none;
      color: var(--text);
      background: rgba(17,24,39,.55);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      line-height: 1.5;
    }
    textarea::placeholder{ color: rgba(229,231,235,.5); }

    .footerRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content: space-between;
      padding: 12px;
      border-top: 1px solid var(--border);
      background: rgba(0,0,0,.12);
    }
    .bookmarkletBox{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .link{
      color: var(--primary);
      text-decoration: none;
      border-bottom: 1px dashed rgba(96,165,250,.5);
      padding-bottom: 1px;
    }
    .hint{
      color: var(--muted);
      font-size: 12px;
    }

    .status{
      padding: 12px;
      border-top: 1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .status.error{
      color: var(--danger);
    }

    /* Make inputs feel better on mobile */
    @media (max-width: 520px){
      textarea{ min-height: 34vh; font-size: 14px; }
      .btn{ width: 100%; justify-content:center; }
      .panelActions .btn{ width:auto; }
      .toolbar .btn{ flex:1; justify-content:center; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>JavaScript Minify / Format Tool</h1>
      <div class="subtitle">
        Mobile-friendly UI with large tap targets. Paste code, minify, format, and copy easily.
      </div>
    </header>

    <div class="card" role="application" aria-label="JavaScript Minify and Format Tool">
      <div class="toolbar">
        <button id="btnMinify" class="btn primary" type="button" title="Minify input into the output box">
          Minify ↓
        </button>
        <button id="btnFormat" class="btn primary" type="button" title="Format output into the input box">
          Format ↑
        </button>
        <button id="btnSwap" class="btn" type="button" title="Swap input and output">
          Swap ⇄
        </button>
        <button id="btnClear" class="btn danger" type="button" title="Clear both boxes">
          Clear
        </button>
      </div>

      <div class="split">
        <section class="panel" aria-label="Original code panel">
          <div class="panelHead">
            <div class="panelTitle">Input (original / formatted)</div>
            <div class="panelActions">
              <button id="btnPasteIn" class="btn" type="button" title="Paste from clipboard into Input">
                Paste
              </button>
              <button id="btnCopyIn" class="btn" type="button" title="Copy Input to clipboard">
                Copy
              </button>
            </div>
          </div>
          <textarea id="taInput" placeholder="Paste JavaScript here..."></textarea>
        </section>

        <section class="panel" aria-label="Minified code panel">
          <div class="panelHead">
            <div class="panelTitle">Output (minified)</div>
            <div class="panelActions">
              <button id="btnCopyOut" class="btn" type="button" title="Copy Output to clipboard">
                Copy
              </button>
              <button id="btnSelectOut" class="btn" type="button" title="Select all in Output">
                Select
              </button>
            </div>
          </div>
          <textarea id="taOutput" placeholder="Minified code will appear here..."></textarea>
        </section>
      </div>

      <div class="footerRow">
        <div class="bookmarkletBox">
          <div class="hint">Bookmarklet link:</div>
          <a id="bookmarklet" class="link" href="about:blank" draggable="true" aria-label="Bookmarklet link">
            bookmarklet
          </a>
        </div>
        <div class="hint" id="liveHint">Tip: on iOS/Safari, long-press the link to add it to bookmarks.</div>
      </div>

      <div id="status" class="status" aria-live="polite"></div>
    </div>
  </div>

  <script>
    window.addEventListener("load", () => {
      const jsUri = "javascript:";
      const $ = (id) => document.getElementById(id);

      const taInput = $("taInput");
      const taOutput = $("taOutput");
      const status = $("status");
      const bookmarklet = $("bookmarklet");

      const btnMinify = $("btnMinify");
      const btnFormat = $("btnFormat");
      const btnSwap = $("btnSwap");
      const btnClear = $("btnClear");

      const btnPasteIn = $("btnPasteIn");
      const btnCopyIn = $("btnCopyIn");
      const btnCopyOut = $("btnCopyOut");
      const btnSelectOut = $("btnSelectOut");

      function setStatus(message, isError = false) {
        status.classList.toggle("error", !!isError);
        status.textContent = message || "";
      }

      function updateButtons() {
        btnMinify.disabled = !taInput.value.trim();
        btnFormat.disabled = !taOutput.value.trim();
        btnSwap.disabled = !taInput.value.trim() && !taOutput.value.trim();
        btnClear.disabled = !taInput.value.trim() && !taOutput.value.trim();
        btnCopyIn.disabled = !taInput.value.trim();
        btnCopyOut.disabled = !taOutput.value.trim();
        btnSelectOut.disabled = !taOutput.value.trim();
      }

      function setBookmarkletFromCode(code) {
        if (!code || !code.trim()) {
          bookmarklet.href = "about:blank";
          return;
        }
        // Use encodeURIComponent for safer encoding
        bookmarklet.href = jsUri + encodeURIComponent(code);
      }

      async function safeClipboardWrite(text) {
        try {
          await navigator.clipboard.writeText(text);
          return true;
        } catch (e) {
          // Fallback: select and prompt manual copy (best effort)
          return false;
        }
      }

      async function safeClipboardRead() {
        try {
          return await navigator.clipboard.readText();
        } catch (e) {
          return "";
        }
      }

      function normalizeBookmarkletInput(code) {
        let c = (code || "").trim();
        if (c.startsWith(jsUri)) {
          c = c.slice(jsUri.length);
          try {
            c = decodeURIComponent(c);
          } catch (_) {
            // If it's not URI-encoded, keep as-is.
          }
        }
        return c;
      }

      async function doMinify() {
        try {
          setStatus("");
          const inputText = taInput.value;
          if (!inputText.trim()) return;

          btnMinify.disabled = true;
          const result = await Terser.minify(inputText, {
            mangle: false,
            compress: { sequences: false, join_vars: false }
          });

          if (result.error) throw result.error;
          taOutput.value = result.code || "";
          setBookmarkletFromCode(result.code || "");
          setStatus("Minified successfully.");
        } catch (error) {
          console.log(error);
          setStatus((error && (error.stack || error.message)) ? (error.stack || error.message) : String(error), true);
        } finally {
          updateButtons();
        }
      }

      async function doFormat() {
        try {
          setStatus("");
          let code = taOutput.value;
          if (!code.trim()) return;

          btnFormat.disabled = true;
          code = normalizeBookmarkletInput(code);

          const formatted = prettier.format(code, {
            parser: "babel",
            semi: true,
            singleQuote: true,
            plugins: prettierPlugins
          });

          taInput.value = formatted;
          setStatus("Formatted successfully.");
        } catch (error) {
          console.log(error);
          setStatus((error && (error.stack || error.message)) ? (error.stack || error.message) : String(error), true);
        } finally {
          updateButtons();
        }
      }

      function doSwap() {
        const a = taInput.value;
        taInput.value = taOutput.value;
        taOutput.value = a;
        setBookmarkletFromCode(taOutput.value);
        setStatus("Swapped input and output.");
        updateButtons();
      }

      function doClear() {
        taInput.value = "";
        taOutput.value = "";
        setBookmarkletFromCode("");
        setStatus("");
        updateButtons();
      }

      btnMinify.addEventListener("click", doMinify);
      btnFormat.addEventListener("click", doFormat);
      btnSwap.addEventListener("click", doSwap);
      btnClear.addEventListener("click", doClear);

      btnSelectOut.addEventListener("click", () => {
        taOutput.focus();
        taOutput.select();
        setStatus("Output selected. Copy it from the system menu if needed.");
        updateButtons();
      });

      btnCopyIn.addEventListener("click", async () => {
        const ok = await safeClipboardWrite(taInput.value);
        setStatus(ok ? "Input copied to clipboard." : "Could not access clipboard. Select and copy manually.", !ok);
      });

      btnCopyOut.addEventListener("click", async () => {
        const ok = await safeClipboardWrite(taOutput.value);
        setStatus(ok ? "Output copied to clipboard." : "Could not access clipboard. Select and copy manually.", !ok);
      });

      btnPasteIn.addEventListener("click", async () => {
        const text = await safeClipboardRead();
        if (!text) {
          setStatus("Clipboard read failed (browser permissions). Paste manually into the Input box.", true);
          return;
        }
        taInput.value = text;
        setStatus("Pasted into Input.");
        updateButtons();
      });

      // Live updates
      taInput.addEventListener("input", () => {
        setStatus("");
        updateButtons();
      });
      taOutput.addEventListener("input", () => {
        setStatus("");
        setBookmarkletFromCode(normalizeBookmarkletInput(taOutput.value));
        updateButtons();
      });

      // Initial state
      setStatus("Ready.");
      updateButtons();
    });
  </script>
</body>
</html>
